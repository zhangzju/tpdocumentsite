## 开发人员的workflow概述

对于单一的项目来说，一个开发人员的指的是在gitlab上的角色为developer，针对某个issue建立的分支进行开发，完成后进行提交然后由管理人员进行操作的同事。

开发人员的主要流程分为分支获取，本地开发，代码提交三个部分。



## 分支获取

### 获取帐号

**这项操作针对每个用户只需要一次。**

我们的gitlab服务器支持LDAP登陆，大家可以使用自己的<strong>内网帐号</strong>登陆gitlab,系统会自动给大家创建帐号。

### 加入项目

**这项操作针对每个项目只需要一次。**

在一项工作开发之前，由于我们的代码管理策略中，不允许非项目相关人员接触代码，因此你刚刚进入gitlab的时候只能看到权限为Public的代码。

你需要向项目管理人员，项目拥有者进行申请，然后会被加入项目。

### 获取代码

在本地没有代码的情况下，一般采取直接使用全局clone来获取远程代码，对于我们的项目来说，当我们获取到远程代码的时候，本地是处于develop分支（这里以C20为例）：

```shell
git clone https://spcodes.rd.tp-link.net/sw1/Archer_C20SP_V4.git
```
命令会在当前路径下生成一个与项目相同名称的文件夹，并且自动会生成一个仓库，以及本地的develop分支。

### 获取更新

当需要有一项功能进行开发的时候，就需要获取最新的代码，由于所有的最新的代码会最为及时的合并到develop分支，因此我们需要现在develop分支下进行代码的更新：

```shell
git pull origin/develop #可以省略origin/develop，如果你能够确保你是在本地的develop分支下面运行的话

```
### 切换到本地的同名分支

当管理人员分配任务之后，远程仓库会生成一个以issue名称命名的分支，但是在本地并没有这个分支，所以需要在本地进行与远程分支对应的分支的创建与切换，原则只有一个，本地分支和远程分支的名称一定要完全一致。

为了确保一致，首先可以查看当前分支的情况：

```shell
git branch -va
```
以VR1200v为例，会看到这样的情况：

```shell
➜  VR1200v git:(master) git branch -va
* master                 69b83c3 1.修复一处可能造成死锁的代码
  remotes/origin/HEAD    -> origin/master
  remotes/origin/develop 69e7cac 1.增加DSL和Multi EWAN共存的支持 2.
  remotes/origin/master  69b83c3 1.修复一处可能造成死锁的代码
```
带有remotes前缀的均为远程分支。

此时，我们可以复制我们分配到任务的名字(指的是remotes/origin/之后的分支的名字)，然后创建我们的分支并且进入这个分支，这项操作只需要一个命令：

```shell
 git checkout -b $feature_name
```

## 本地开发

在进行本地开发的时候，需要先对仓库进行一些配置，例如添加.gtiignore文件，以及更改分支推送的策略等，详见[git初次运行前的配置](/doc/#/gitlab/basic)与[git本地操作快速入门](/doc/#/gitlab/git_local)。

### 暂存修改的文件

在进行开发的过程中，我们的大致过程是修改文件，编译，验证结果，提交。

针对这个过程，我们的最佳开发流程与网络上和git官方的推荐流程有所不同。

当我们修改了一些文件的时候，我们先暂存所有的修改过后的文件。
```shell

git add --all

```
此时我们修改后的文件进入了暂存区。

### 编译验证

我们需要修改的文件进入暂存区域之后，需要对我们修改的代码进行编译和验证。

验证的结果有两种：

1. 验证成功，提交：

```shell

git commit -m "message" #注意将message替换为自己的提交备注

```
2. 验证失败，此时我们的仓库中已经不止是我们需要修改的文件处于等待被暂存的状态，有大量的生成文件会影响我们的操作，因此我们需要做一些操作清理掉这些影响的信息，最好的办法就是让所有的文件恢复到上一次提交时的状态：

```shell
git reset --hard <HEAD> #这里的HEAD指的是上一次提交的哈希值，获取方式见[git本地操作快速入门]
```

此时你的仓库中的文件会回到最初的状态，然后你需要删除所有无关的生成文件：

```shell
git clean -df　# 这个命令会删除所有无关文件，但是有些文件位于.gitignore中不会被影响，所以不用担心会删除必须的文件

```

此时，你的仓库已经回到了修改前的状态，你可以进行下一次修改来重复这个流程。

## 代码提交

### 将代码上传到远程仓库

当本地验证无误之后，可以将代码上传到服务器，操作方法如下：

```shell
 git push origin $feature_name　#这里必须确保你实在工作分支下面进行，而且千万注意要按照[git初次运行前的配置]进行操作
```
上传之后的代码可能会被退回，但是整个流程依然可以从本地开发那一部分开始进行闭环的重复操作，确保开发过程没有问题。

### 分支删除后的处理

当一个功能通过了管理人员的检验之后，远程仓库上的开发分支将会被合并并且删除，因此在本地的开发分支也就没有了意义，为了能够随时保持立即可以开发的状态，需要切换回道develop分支进行操作。

```shell
git checkout develop
```

