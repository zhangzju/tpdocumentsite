## 管理人员操作基本流程

我们需要开发一个新功能，或者解决一个Bug，以至于针对一个定制单做出软件客制化的时候，我们般是按照一下流程进行的：

* 需求产生
* 创建解决方案issue
* 创建专属分支
* 分配开发人员
* 本地开发及提交
* 代码自我审查
* 合并和发布

在这个流程基础上，我们需要明确关于默认受保护的几个分支的概念，按照gitlab workflow的规范，我们一般有三类分支：

* master分支，用于发布重大版本，受保护，只有项目拥有者有权更改
* develop分支，用于保证最新的开发工作，项目管理人员有权更改
* feature分支，名字可以有很多，用于某个单独功能开发，分配的开发人员有权更改

### 需求产生

在我们的日常开发中，需求大概来字三个部分：

* Bug修复
* 基础新功能
* 定制单客制化

其中，bug的修复基本是和Bugzilla需要进行关联，基础新功能和定制单的客制化则需要在Redmine上有记录。

### 创建解决方案issue

如下图，在每个项目的主界面的导航栏中即可进入issue管理，从而建立新的issue：

![create issue](imgs/git_new_feature/create_issue.png)

在创建一个issue的时候，我们需要填写的信息有：

* Title:　issue的名称，简要说明目的
* Description: 描述信息，需要从相应的Bugzilla或者Redmine页面同步到这里
* Credential:　勾选选项，是否只对组内成员可见，默认不勾选，即所有人都可以参与到讨论中
* Assignee: 任务分配给到的工程师，只有一位，若有多位，则需要更加一步细分功能
* Due date: 预计完成的日期
* Milestone: 里程碑，用于标记问题的重大进展
* Label: 标签，选择这个issue的来源

填写完所有信息之后，点击Submit issue即可创建。

issue不仅是为了提出开发的需求，也是给所有相关的工程师一个讨论问题的平台，类似于论坛，大家都可对别人意见提出评论。

### 创建专属分支

在issue创建完成之后，即可对这个issue创建分支。

如下图：

![create_branch](imgs/git_new_feature/new_branch.png)

可以看到右侧出现了issue相关的信息，包括处理者，项目从属等等。

点击“create branch”即可创建一个对应的分支。

### 分配开发人员

分支建立完成之后就可以让开发人员去处理相关的工作了。一般开发人员即是这个issue的assignee，这个成员对分支有push的权限。

### 本地开发以及提交

开发人员获取到自己分配的分支之后，按照之前的[开发人员在workflow工作流中的最佳实践](/doc/#/gitlab/gitlab_developer_workflow)中的流程进行开发，完成后进行提交。

在本地提交之前，需要确认一下提交的内容中是否被污染，或者是否在正确的分支上工作，一般采用如下命令：

```shell
git diff HEAD HEAD^ --stat
```
会有如下结果产生：

![git diff to push](imgs/git_new_feature/001.png)

可以很清晰的看到自己的文件操作。

### 代码自我审查

开发人员将代码提交到远程分支之后，所有的项目开发人员均可以对代码进行初步审查，只需要点击进入开发分支相对应的commit，即可非常迅速的看到代码的更改：

![review code](imgs/git_new_feature/002.png)

一般代码的初步审查是为了避免出现较大的问题，这部分是由开发人员自行完成，也可以让团队其他成员帮忙进行。这部分确认无误之后，需要进行代码的Review和分支合并。


### 合并和发布

代码自我结束之后，如果确认有疑问，开发人员可以在分支上继续修改，如果确认没有疑问，则可以在自己的任务界面点击Ｄone,如下图：

![to do](imgs/git_new_feature/merge_request.png)

此时，项目管理人员即可发起Merge Request,如下图所示，被标注的部分有提出Merge Request的按钮，点击即可：

![merge request](imgs/git_new_feature/003.png)

在Ｍerge Request的界面，需要指定相应的管理人员来进行代码的Review以及合并操作，需要注意的是，这个管理人员必须具有分支合并的权限，因此也需是master级别及以上：

![assignee of todo](imgs/git_new_feature/004.png)

如图，标记出来的部分是指定负责进行分支合并处理的人员，指定之后，该成员会在自己的主界面收到消息，而分支合并也会进入他的to do任务列表之中。

在合并完成之后，分支可以被删除，当develop上的代码被更改，即可触发自动构建的开始，编译通过之后，即可进行后续的操作。